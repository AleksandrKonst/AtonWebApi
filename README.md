# AtonWebApi

[![.NET Core Desktop](https://github.com/AleksandrKonst/AtonWebApi/actions/workflows/dotnet-desktop.yml/badge.svg)](https://github.com/AleksandrKonst/AtonWebApi/actions/workflows/dotnet-desktop.yml)

1. [**Структура.**](#01)
2. [**Инструкция.**](#02)
3. [**Задание.**](#03)

## 01. Структура.<a name="01"></a>
Проект построен по принципам `Clean Architecture` и `CQRS` для снижения зависимости между компонентами. Также реализует паттерн `посредник`.

Структура проекта:
- `Domain` - сущности и интерфейсы.
- `Infrastructure` - реализация сервисов доступа к хранилищу.
- `Application` - связующее звено, включает резолверы команд и запросов.
- `AtonWebApi` - конечные точки.
- `UnitTests` - модульные тесты.

В проекти автоматизировано тестирование с помощью [GitHub Actions](https://github.com/AleksandrKonst/AtonWebApi/actions).

База данных - `PostgreSQL`.

Для размещения используеться `Docker compose`.

В качестве инструмента валидации на сервисном уровне выступает `FluentValidation`.

Данные о пользователе хранятся в `JWT`. (В зпросах необходимо указывать заголовок `JWT Bearer`)

`Api` использует версионность.

Компоненты нижних уровней документированы:

![image](https://github.com/AleksandrKonst/AtonWebApi/assets/40522320/e55e5f25-4936-4c35-8dad-ee4056bd5ce2)

## 02. Инструкция.<a name="02"></a>

В корневой папке проекта.

```
docker compouse up
```

После запуска переходим по `URL`

http://localhost:7114/swagger/index.html

Входим в заранее заготовленный аккаунт администратора.

```jsom
{
  "login": "aleksandr",
  "password": "1243"
}
```

![image](https://github.com/AleksandrKonst/AtonWebApi/assets/40522320/be0a8d1a-a106-465a-83da-e877c612871c)

![image](https://github.com/AleksandrKonst/AtonWebApi/assets/40522320/2cbc906c-c6d1-490d-8a73-a7348ecfeefe)

![image](https://github.com/AleksandrKonst/AtonWebApi/assets/40522320/ef862673-1808-485e-afa4-60d139f6037a)

Далее можно выполнять любые запросы.

## Пример
Создание пользователя.

![image](https://github.com/AleksandrKonst/AtonWebApi/assets/40522320/3a787f92-60fa-4476-ae55-76371bda38ed)

![image](https://github.com/AleksandrKonst/AtonWebApi/assets/40522320/9e250f7f-c913-4314-b51e-944796fdf350)

## 03. Задание.<a name="03"></a>
- Примечание: Желательно выложить код на гитхаб или в любую доступную систему контроля
версий.
- Задание: Написать `Web API` сервис на `.NET Core 3.1` или выше, реализующий `API` методы `CRUD` над
сущностью `Users`, доступ к API должен осуществляться через интерфейс `Swagger`.
- Все действия могут происходить в оперативной памяти и не сохраняться при остановке
приложения (по желанию подключить любую базу данных).
- Предварительно должен быть создан пользователь `Admin`, от имени которого будут вначале
происходить действия.

`CRUD` методы контроллера `UsersController`

!!!Во всех запросах должны присутствовать параметры логин и пароль выполняющего запрос!!!
- (по желанию возвращать текст ошибки при невозможности выполнить действие)
- (по желанию можно добавить выдачу и использование токена)

`Create`
- Создание пользователя по логину, паролю, имени, полу и дате рождения + указание будет ли
пользователь админом (Доступно Админам)

`Update-1`
- Изменение имени, пола или даты рождения пользователя (Может менять Администратор, либо
лично пользователь, если он активен (отсутствует RevokedOn))
- Изменение пароля (Пароль может менять либо Администратор, либо лично пользователь, если
он активен (отсутствует RevokedOn))
- Изменение логина (Логин может менять либо Администратор, либо лично пользователь, если
он активен (отсутствует RevokedOn), логин должен оставаться уникальным)

`Read`
- Запрос списка всех активных (отсутствует RevokedOn) пользователей, список отсортирован по
CreatedOn (Доступно Админам)
- Запрос пользователя по логину, в списке долны быть имя, пол и дата рождения статус активный
или нет (Доступно Админам)
- Запрос пользователя по логину и паролю (Доступно только самому пользователю, если он
активен (отсутствует RevokedOn))
- Запрос всех пользователей старше определённого возраста (Доступно Админам)

`Delete`
- Удаление пользователя по логину полное или мягкое (При мягком удалении должна
происходить простановка RevokedOn и RevokedBy) (Доступно Админам)

`Update-2`
- Восстановление пользователя - Очистка полей (RevokedOn, RevokedBy) (Доступно Админам)
Поля сущности User

```
Guid - Guid - Уникальный идентификатор пользователя
Login - string - Уникальный Логин (запрещены все символы кроме латинских букв и цифр),
Password - string - Пароль(запрещены все символы кроме латинских букв и цифр),
Name - string - Имя (запрещены все символы кроме латинских и русских букв)
Gender - int - Пол 0 - женщина, 1 - мужчина, 2 - неизвестно
Birthday - DateTime? - поле даты рождения может быть Null
Admin - bool - Указание - является ли пользователь админом
CreatedOn - DateTime - Дата создания пользователя
CreatedBy - string - Логин Пользователя, от имени которого этот пользователь создан
ModifiedOn - DateTime - Дата изменения пользователя
ModifiedBy - string - Логин Пользователя, от имени которого этот пользователь изменён
RevokedOn - DateTime- Дата удаления пользователя
RevokedBy - string - Логин Пользователя, от имени которого этот пользователь удалён
```
